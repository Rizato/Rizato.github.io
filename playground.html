---
layout: default
title: Playground
description: Try Ragelang in your browser - an interactive code editor and game canvas
permalink: /playground/
---
<div class="loading-overlay" id="loading">
  <div class="loading-spinner"></div>
  <div class="loading-text">Loading Ragelang...</div>
</div>

<div class="playground-main">
  <div class="playground-panel">
    <div class="panel-header">
      <div class="panel-header-left">
        <div class="playground-tabs">
          <button class="playground-tab active" data-tab="source">Source</button>
          <button class="playground-tab" data-tab="processed">Processed</button>
        </div>
        <div class="example-selector">
          <select id="example-select">
            <option value="bouncing-ball">Bouncing Ball</option>
            <option value="platformer">Platformer</option>
            <option value="hello-world">Hello World</option>
            <option value="custom">Custom</option>
          </select>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary" id="clear-btn">Clear</button>
        <button class="btn btn-primary" id="run-btn">▶ Run</button>
      </div>
    </div>
    <div class="code-editor">
      <div class="line-numbers" id="source-line-numbers"></div>
      <div class="code-content">
        <textarea id="editor" placeholder="Write your Ragelang code here...

Remember: Characters must be supported by characters beneath them!
Use # to create the foundation." spellcheck="false"></textarea>
        <div id="processed" class="processed-view"></div>
      </div>
    </div>
  </div>
  
  <div class="playground-panel">
    <div class="panel-header">
      <span class="panel-title">Output</span>
      <button class="btn btn-secondary" id="stop-btn">⏹ Stop</button>
    </div>
    <div class="canvas-wrapper">
      <canvas id="game-canvas" width="600" height="400" tabindex="0"></canvas>
    </div>
    <div class="console-area">
      <div class="console-header">Console</div>
      <div id="console"></div>
    </div>
  </div>
</div>

<script type="module">
  // Example programs
  const EXAMPLES = {
    'hello-world': `//         to RageLang!
// Welcome  | | | | |
// | | | |   | | | |
// Author:    Rizato
print("Hello, World! ")
// | | | | |         |
######################`,

    'bouncing-ball': `// A simple bouncing ball demo
// | | | | | | | | | | | | | |
//  | | | | | |   | | | | | |
ball_x = 300 //    | | | | |
ball_y = 200 //     | | | |
vel_x = 150 //       | | |
vel_y = 100 //        | |
draw { // | |          |
 // | | | | |          |
  clear("#1a1a2e") //  |
  circle(ball_x, ball_y, 20, "#ff3366")
  text("Bouncing Ball", 10, 30, 24, "#ffffff")
} //  | | | | | | | | | | | | | | | | | | | |
// | | | | | | | | | | | | | |   | | | | | |
update(dt) { // | | | | | | | |   | | | | |
 // | | | | | | | | | | | | | |    | | | | 
  ball_x = ball_x + vel_x * dt //   | | |
  ball_y = ball_y + vel_y * dt //    | |
  // | | | | | | | | | | | | | |      |
  if (ball_x > 580) { //  | | |       |
  // | | | | | | | | | |   | |       |
   // | | | | | | | | |     |       |
    vel_x = -150 // | |      |     |
  } // | | | | | | | |        |   |
  if (ball_x < 20) { //        | |
   // | | | | | | | | |         | 
    // | | | | | | | |         |
    vel_x = 150 // | |        |
  } // | | | | | | | |       |
  if (ball_y > 380) { //    |
   // | | | | | | | | |    |
    // | | | | | | | |    |
    vel_y = -100 // |    |
  } // | | | | | | |    |
  if (ball_y < 20) { //|
   // | | | | | | | | |
    // | | | | | | | |
    vel_y = 100 //| |
  } // | | | | | | |
} //  | | | | | | | 
// | | | | | | | | 
##################`,

    'platformer': `// Simple platformer with controls
//  | | | | | | | | | | | | | | |
//   | | | | | | | | | |   |   |
player = prototype() //     | |
player.x = 100 //  | |       |
player.y = 300 //   |       |
player.vel_y = 0 // |      |
player.on_ground = true //|
//  | | | | | | | | | | | |
gravity = 800 //   |   | |
jump_force = -400 //    |
move_speed = 200 //     |
// | | | | | | | |      |
ground_y = 350 //       |
// | | | | | | |        |
// Trail system         |
trail = [] //  |        |
trail_max = 8 //        |
//  | | | | | |         |
// Helper function     |
fun apply_gravity(dt) {
 // | | | | | | | | | | 
  if (player.on_ground == false) {
   // | | | | | | | | | | | | |  | 
    player.vel_y = player.vel_y + gravity * dt
  } //  | | | | | | | | | | | | | | | | | | |
} // |   | | | | | | | | | |   | |   |   | |
// | |    | | | | | | | | |     | | | | | | 
// Store position for trail      |   |   |
fun update_trail() { // | |       | | | |
 // Only add trail  | |  | |       |   |
  if (player.on_ground == false) { // |
   // Add current position to trail  |
    pos = prototype() //  | | | | | |
    pos.x = player.x //    |   |   | 
    pos.y = player.y //     | | | | 
    push(trail, pos) //      |   |
    // Limit trail length     | |
    loop { //  | | | | |       |
     // | | |   | | | |        | 
      if (len(trail) <= trail_max) {
       //  | | | | | | | | | | | | | 
        break //  |   |   |   |   |
      } // | | | | | | | | | | | |
      // Remove oldest  | |   | |
      trail = trail[1:] // | | |
    } // |  | | | | | | | |   |
  } // | |   | | | |   | | | |
} // | | |    |   |     |   |
// | | | |     | |       | |
draw { //       |         |
 // | | |       |         |
  clear("#2d3436") //     |
  // Draw ground | |      |
  rect(0, ground_y, 600, 50, "#636e72")
  // Draw trail when jumping | | | | |
  if (len(trail) > 0) { // |  | | | |
   // | | | | | | | | | | |    |   | 
    i = 0 // | | | | | | |      | |
    loop { //   | |   | |        | 
     // | | |    | | | |         |
      if (i >= len(trail)) { // |
       // | | | | | | | | | | | |
        break // | | | | | | | |
      } //  | | | | | | | | | |
      pos = trail[i] //| | | |
      // Cosine alpha falloff
      t = i / trail_max // |
      alpha = cos(t * 1.5708) * 0.6
      // Cyan trail with alpha | | |
      rect(pos.x, pos.y, 32, 32, "#00cec9", alpha)
      i = i + 1 //  | | | | | | | | | | | | | | |
    } //   | | | | | | | | | | | | | | | | | | |
  } //  | | | | | | | | | | | | | | | | | | | |
  // Draw player | | | | | | | | | | | | | | |
  rect(player.x, player.y, 32, 32, "#00cec9")
  // Instructions  | | | | | | | | | | | | | | |
  text("Arrows/WASD to move, Space to jump", 10, 30, 16, "#dfe6e9")
} //  | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | |
// |   | | | | | | | |   | | | | | |   | | | | | |   |   |   |   |
update(dt) { // | | |     |   |   |     |   |   |     | | | | | |
 //  | | | | | | | |       | | | |       | | | |       |   |   |  
  // Apply gravity  |       |   |         |   |         | | | |
  apply_gravity(dt) //       | |           | |           |   | 
  // Left/right movement      |             |             | |
  if (key_held("ArrowLeft")) { //           |              |
   // | | | | | | | | | | | | | |           |              |
    player.x = player.x - move_speed * dt //               |
  } // |  | | | | | | | | | | | | | | | | |                |
  if (key_held("ArrowRight")) { // | | | |                 |
   // | | | | | | | | | | | | | | | | | |                  |
    player.x = player.x + move_speed * dt //               |
  } //  | | | | | | | | | | | | | | | | | |                |
  if (key_held("a")) { //  | | | | | | | |                 |
   // | | | | | | | | | | | | | | | | | |                  |
    player.x = player.x - move_speed * dt //               |
  } //  | | | | | | | | | | | | | | | | | |                |
  if (key_held("d")) { //  | | | | | | | |                 |
   // | | | | | | | | | | | | | | | | | |                  |
    player.x = player.x + move_speed * dt //               |
  } //  | | | | | | | | | | | | | | | | | |                |
  // Jump  | |   |   |   | |   | | | | | |                 |
  if (pressed("jump")) { //     |   |   |                  |
   //  | | | | | | | | | |       | | | |                   |
    if (player.on_ground) { //    |   |                    |
     //  | | | | | | | | | | |     | |                     |
      player.vel_y = jump_force //  |                      | 
      player.on_ground = false //   |                      | 
      // Clear trail on new jump    |                      | 
      trail = [] //   | | | | |     |                      | 
    } //| | | | | |    | | | |      |                      | 
  } // | | | | | |      |   |       |                      | 
  // Update trail        | |        |                      | 
  update_trail() //       |         |                      | 
  // Update vertical      |         |                      |
  player.y = player.y + player.vel_y * dt //               |
  // Keep player in bounds  | | | | | | | |                |
  if (player.x < 0) { // | |   | | | | | |                 |
   // | | | | | | | | | | |     |   |   |                  |
    player.x = 0 // | | | |      | | | |                   |
  } // | | | | | | | | | |        |   |                    |
  if (player.x > 568) { //         | |                     |
   //  | | | | | | | | | |          |                      |
    player.x = 568 // | |          |                       |
  } // | | | | | | | | |          |                        |
  // Ground collision  |         |                         |
  if (player.y > ground_y - 32) { //                       |
   // | | | | | | | | | | | | | | |                        |
    player.y = ground_y - 32 //| |                         |
    player.vel_y = 0 // | | | | |                          |
    player.on_ground = true // |                           |
    // Clear trail on landing |                            |
    trail = [] //  | | | | | |                             |
  } //  | | | | | | | | | | |                              |
} // | | | | | | | | | | | |                               |
###########################                                #`
  };

  // DOM Elements
  const editor = document.getElementById('editor');
  const processedView = document.getElementById('processed');
  const consoleEl = document.getElementById('console');
  const canvas = document.getElementById('game-canvas');
  const runBtn = document.getElementById('run-btn');
  const stopBtn = document.getElementById('stop-btn');
  const clearBtn = document.getElementById('clear-btn');
  const tabs = document.querySelectorAll('.playground-tab');
  const lineNumbers = document.getElementById('source-line-numbers');
  const exampleSelect = document.getElementById('example-select');
  const loadingOverlay = document.getElementById('loading');

  let ragelang = null;
  let currentTab = 'source';

  // Import Ragelang from local bundle
  import { Ragelang, FallingProcessor } from '{{ "/assets/js/ragelang.bundle.js" | relative_url }}';
  
  // Hide loading overlay once module is loaded
  loadingOverlay.classList.add('hidden');

  function loadExample(name) {
    if (EXAMPLES[name]) {
      editor.value = EXAMPLES[name];
      updateLineNumbers(editor.value);
      stop();
      clearConsole();
    }
  }

  function updateLineNumbers(text) {
    const lines = text.split('\n');
    lineNumbers.innerHTML = lines.map((_, i) => 
      `<span class="line-num">${i + 1}</span>`
    ).join('');
  }

  function log(message, type = 'info') {
    const line = document.createElement('div');
    line.className = `console-line ${type}`;
    line.textContent = message;
    consoleEl.appendChild(line);
    consoleEl.scrollTop = consoleEl.scrollHeight;
  }

  function clearConsole() {
    consoleEl.innerHTML = '';
  }

  // Override console.log to capture output
  const originalLog = console.log;
  console.log = function(...args) {
    originalLog.apply(console, args);
    log(args.join(' '));
  };

  function escapeHtml(str) {
    return str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function updateProcessedView() {
    try {
      const source = editor.value;
      const processor = new FallingProcessor(source);
      
      const sourceLines = source.split('\n');
      const processed = processor.process();
      
      if (!processed) {
        processedView.innerHTML = '<span style="color: var(--text-muted)">(empty - no foundation found)</span>';
        updateLineNumbers('');
        return;
      }

      const processedLines = processed.split('\n');
      const fallenPositions = new Set();
      
      for (let row = 0; row < processedLines.length; row++) {
        for (let col = 0; col < processedLines[row].length; col++) {
          const char = processedLines[row][col];
          if (char !== ' ') {
            const key = `${row},${col}`;
            const originalChar = sourceLines[row]?.[col];
            if (originalChar !== char) {
              fallenPositions.add(key);
            }
          }
        }
      }
      
      let html = '';
      for (let row = 0; row < processedLines.length; row++) {
        const line = processedLines[row];
        for (let col = 0; col < line.length; col++) {
          const char = line[col];
          const key = `${row},${col}`;
          if (fallenPositions.has(key) && char !== ' ') {
            html += `<span class="fallen-char">${escapeHtml(char)}</span>`;
          } else {
            html += escapeHtml(char);
          }
        }
        html += '\n';
      }
      
      processedView.innerHTML = html;
      updateLineNumbers(processed);
    } catch (e) {
      processedView.innerHTML = `<span style="color: var(--accent-coral)">Error: ${escapeHtml(e.message)}</span>`;
    }
  }

  function run() {
    stop();
    clearConsole();
    
    try {
      ragelang = new Ragelang({ canvas, width: 600, height: 400 });
      log('Running Ragelang program...', 'success');
      ragelang.run(editor.value);
      ragelang.start();
      updateProcessedView();
      // Focus the canvas so keyboard input goes to the game, not buttons
      canvas.focus();
    } catch (e) {
      log(`Error: ${e.message}`, 'error');
      console.error(e);
    }
  }

  function stop() {
    if (ragelang) {
      ragelang.stop();
      ragelang = null;
    }
  }

  // Event Listeners
  editor.addEventListener('scroll', () => {
    lineNumbers.scrollTop = editor.scrollTop;
  });

  editor.addEventListener('input', () => {
    if (currentTab === 'source') {
      updateLineNumbers(editor.value);
    }
    // Mark as custom when user edits
    if (!Object.values(EXAMPLES).includes(editor.value)) {
      exampleSelect.value = 'custom';
    }
  });

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      currentTab = tab.dataset.tab;
      if (currentTab === 'source') {
        editor.style.display = 'block';
        processedView.classList.remove('visible');
        updateLineNumbers(editor.value);
      } else {
        editor.style.display = 'none';
        processedView.classList.add('visible');
        updateProcessedView();
      }
    });
  });

  exampleSelect.addEventListener('change', (e) => {
    const value = e.target.value;
    if (value !== 'custom') {
      loadExample(value);
    }
  });

  runBtn.addEventListener('click', () => {
    run();
    runBtn.blur(); // Remove focus so spacebar doesn't re-trigger
  });
  stopBtn.addEventListener('click', () => {
    stop();
    stopBtn.blur();
  });
  clearBtn.addEventListener('click', () => {
    editor.value = '';
    stop();
    clearConsole();
    updateLineNumbers('');
    exampleSelect.value = 'custom';
    clearBtn.blur();
  });

  // Handle keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + Enter to run
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
      e.preventDefault();
      run();
    }
  });

  // Load initial example
  loadExample('bouncing-ball');
</script>
